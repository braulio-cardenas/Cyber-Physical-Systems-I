<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grayscale + Bit Depth + Histogram Playground</title>
  <style>
    :root {
      --bg: #0b0f14; --panel: #111821; --panel-2: #0d131b;
      --text: #e6eef6; --muted: #9fb3c8; --accent: #4aa8ff; --accent-2: #8ad5ff;
      --border: #203040; 
    }
    body { margin:0; background:var(--bg); color:var(--text);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    }
    header { padding:16px 20px; border-bottom:1px solid var(--border); }
    header h1 { margin:0 0 4px; font-size:20px; }
    header p { margin:0; color:var(--muted); font-size:13px; }
    .wrap { max-width:1100px; margin:18px auto; padding:0 16px 24px; }
    .panel { background:linear-gradient(180deg,var(--panel),var(--panel-2));
      border:1px solid var(--border); border-radius:14px; padding:14px;
    }
    .group { background:rgba(255,255,255,0.03); border:1px solid var(--border);
      border-radius:12px; padding:12px; margin-bottom:12px;
    }
    .group h2 { font-size:14px; margin:0 0 10px; color:var(--accent-2); }
    .row { display:grid; grid-template-columns:160px 1fr auto; gap:8px; align-items:center; padding:6px 0; }
    .row + .row { border-top:1px dashed var(--border); }
    .seg { display:inline-flex; border:1px solid var(--border); border-radius:10px; }
    .seg input { display:none; }
    .seg label { padding:8px 12px; cursor:pointer; color:var(--text); font-size:13px; }
    .seg input:checked + label { background:var(--accent); color:#02131f; font-weight:700; }
    canvas { background:#0a0e13; border-radius:10px; width:100%; height:auto; }
    .canvas-card { background:rgba(255,255,255,0.03); border:1px dashed var(--border);
      border-radius:12px; padding:12px; margin-top:12px;
    }
    .canvas-head { display:flex; justify-content:space-between; margin-bottom:6px; }
    .canvas-head h3 { margin:0; font-size:14px; color:var(--accent-2); }
    .dim { font-size:12px; color:var(--muted); }
  </style>
</head>
<body>
<header>
  <h1>Grayscale · Bit Depth · Histogram</h1>
  <p>Upload an image, convert to grayscale, reduce bit depth, and view histograms.</p>
</header>

<div class="wrap">
  <div class="panel">
    <div class="group">
      <h2>1) Image</h2>
      <input id="file" type="file" accept="image/*" />
      <button id="loadSample">Load Sample</button>
    </div>

    <div class="group">
      <h2>2) Adjustments</h2>
      <div class="row">
        <label>Color mode</label>
        <div class="seg">
          <input type="radio" id="modeColor" name="mode" value="color" checked />
          <label for="modeColor">Color</label>
          <input type="radio" id="modeGray" name="mode" value="gray" />
          <label for="modeGray">Grayscale</label>
        </div>
      </div>
      <div class="row">
        <label for="bits">Bit depth (per channel)</label>
        <input id="bits" type="range" min="1" max="8" step="1" value="8" />
        <div id="bitsVal">8-bit</div>
      </div>
    </div>
  </div>

  <div class="canvas-card">
    <div class="canvas-head"><h3>Original</h3><div class="dim" id="origDim">–</div></div>
    <canvas id="orig"></canvas>
  </div>

  <div class="canvas-card">
    <div class="canvas-head"><h3>Processed</h3><div class="dim" id="procDim">–</div></div>
    <canvas id="proc"></canvas>
  </div>

  <div class="canvas-card">
    <div class="canvas-head"><h3>Histogram</h3></div>
    <canvas id="hist"></canvas>
  </div>
</div>

<script>
const fileInput = document.getElementById('file');
const loadSampleBtn = document.getElementById('loadSample');
const bits = document.getElementById('bits');
const bitsVal = document.getElementById('bitsVal');
const modeColor = document.getElementById('modeColor');
const modeGray = document.getElementById('modeGray');

const origCanvas = document.getElementById('orig');
const procCanvas = document.getElementById('proc');
const histCanvas = document.getElementById('hist');
const octx = origCanvas.getContext('2d');
const pctx = procCanvas.getContext('2d');
const hctx = histCanvas.getContext('2d');
const origDim = document.getElementById('origDim');
const procDim = document.getElementById('procDim');

let originalImage = new Image();
originalImage.onload = () => {
  const w = originalImage.naturalWidth, h = originalImage.naturalHeight;
  origCanvas.width = w; origCanvas.height = h;
  procCanvas.width = w; procCanvas.height = h;
  histCanvas.width = 512; histCanvas.height = 200;
  octx.drawImage(originalImage,0,0,w,h);
  origDim.textContent = `${w}×${h}px`;
  render();
};

function quantizeChannel(value, bits) {
  const levels = 1<<bits;
  if (levels<=1) return 0;
  const q = Math.round((value/255)*(levels-1));
  return Math.round((q*255)/(levels-1));
}

function render(){
  const w = origCanvas.width, h = origCanvas.height;
  if (!w||!h) return;
  const b = parseInt(bits.value,10);
  const colorMode = modeGray.checked?'gray':'color';
  bitsVal.textContent = `${b}-bit`;

  // get image data
  const imgData = octx.getImageData(0,0,w,h);
  const data = imgData.data;

  // arrays for histogram bins
  let histR = new Array(256).fill(0);
  let histG = new Array(256).fill(0);
  let histB = new Array(256).fill(0);
  let histGray = new Array(256).fill(0);

  for(let i=0;i<data.length;i+=4){
    let r=data[i], g=data[i+1], bl=data[i+2];
    if(colorMode==='gray'){
      const y = 0.299*r+0.587*g+0.114*bl;
      const q = quantizeChannel(y,b);
      data[i]=data[i+1]=data[i+2]=q;
      histGray[q]++;
    }else{
      data[i]=quantizeChannel(r,b);
      data[i+1]=quantizeChannel(g,b);
      data[i+2]=quantizeChannel(bl,b);
      histR[data[i]]++;
      histG[data[i+1]]++;
      histB[data[i+2]]++;
    }
  }

  pctx.putImageData(imgData,0,0);
  procDim.textContent=`${w}×${h}px`;

  // draw histogram
  hctx.clearRect(0,0,histCanvas.width,histCanvas.height);
  const maxVal=colorMode==='gray'?Math.max(...histGray):Math.max(...histR,...histG,...histB);
  const scale=histCanvas.height/maxVal;
  if(colorMode==='gray'){
    hctx.fillStyle='white';
    for(let x=0;x<256;x++){
      const v=histGray[x]*scale;
      hctx.fillRect(x*2,histCanvas.height-v,2,v);
    }
  }else{
    for(let x=0;x<256;x++){
      let v=histR[x]*scale; hctx.fillStyle='red'; hctx.fillRect(x*2,histCanvas.height-v,2,v);
      v=histG[x]*scale; hctx.fillStyle='green'; hctx.fillRect(x*2,histCanvas.height-v,2,v);
      v=histB[x]*scale; hctx.fillStyle='blue'; hctx.fillRect(x*2,histCanvas.height-v,2,v);
    }
  }
}

[fileInput,bits,modeColor,modeGray].forEach(el=>el.addEventListener('input',render));
fileInput.addEventListener('change',e=>{
  const file=e.target.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=ev=>{originalImage.src=ev.target.result;};
  reader.readAsDataURL(file);
});

loadSampleBtn.addEventListener('click',()=>{
  const svg=encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='512' height='512'>
  <defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
  <stop offset='0%' stop-color='#f00'/><stop offset='50%' stop-color='#0f0'/><stop offset='100%' stop-color='#00f'/></linearGradient></defs>
  <rect width='512' height='512' fill='url(#g)'/></svg>`);
  originalImage.src=`data:image/svg+xml,${svg}`;
});
</script>
</body>
</html>

